const apiKey = 'DLxaLENiZb2GzcLaF0bzrnHAMOL7QXzv';
const topNewsUrl = `https://api.nytimes.com/svc/mostpopular/v2/viewed/1.json?api-key=${apiKey}`;

async function getNews(url) {
    try {
        const response = await fetch(url);
        const data = await response.json();
        return data;
    } catch (error) {
        console.error('Error fetching data:', error);
    }
}

async function displayNews(url) {
    const newsType = document.getElementById('newsType');
    const output = document.getElementById('output');
    output.innerHTML = '';

    const data = await getNews(url);

    if (data) {
        newsType.innerText = 'Top News';

        for (let i = 0; i < Math.min(9, data.results.length); i++) {
            const article = data.results[i];
            const imageUrl = article.media[0]?.['media-metadata'][2]?.url || 'https://via.placeholder.com/150';

            output.innerHTML += `
                <div class="card">
                    <div class="card-body">
                        <img src="${imageUrl}" alt="${article.title}" style="width: 100%; height: auto;">
                        <h2 class="card-title">${article.title}</h2>
                        <div class="card-text">
                            <p>${article.abstract}</p>
                            <a href="${article.url}" target="_blank" class="read-more">Read full article</a>
                        </div>
                    </div>
                </div>
            `;
        }
    } else {
        output.innerHTML = '<p>Failed to fetch news.</p>';
    }
}

// Fetch and display top news on page load
displayNews(topNewsUrl);

async function searchNews() {
    const searchTerm = document.getElementById('searchBar').value;
    const searchUrl = searchTerm
        ? `https://api.nytimes.com/svc/search/v2/articlesearch.json?q=${searchTerm}&api-key=${apiKey}`
        : topNewsUrl;

    displayNews(searchUrl);
}
